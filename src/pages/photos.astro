---
import Layout from '../layouts/Layout.astro'
import SiteGridContent from '../components/siteGridContent.astro'

import '../styles/pages/photos.scss'
import data from '../../content/allPhotos/APC_0131/APC_0131'
import type { createSlotValueFromString } from 'astro/runtime/server/render/slot.js'

var site = Astro.site.toString()
if (site.includes('://')) site = site.split('://')[1]
if (site.endsWith('/')) site = site.slice(0, -1)

var photos = await Astro.glob('../../content/allPhotos/*/*')

var datas = []
photos.map((data, i) => {
  data = data.default
  if (data.src) {
    return ''
  }

  datas.push(data)
})

console.log(datas)

photos.map((image, i) => {
  image = image.default
  if (!image.src) {
    return ''
  }

  var data = datas.find(f => f.name = getFNameNoExt(image.src))
  // console.log(data)
})

function getFName(name) {
  if (name.includes('/')) {
    name = name.split('/').slice(-1)
    if (name.includes('.')) {
      if (name.split('.').length > 2) {
        name = `${name.slice(0, -2).join('.')}${name.slice(-1)}`
      }
    }
  }
  return name
}

var options = {
  keys: [
    'min', 
  ], 
  values: {
    min: '24rem', 
  }, 
}
---
<Layout title="Photos">
  <SiteGridContent classItems="photos" options={options} mode="lite">
    {
      photos.map(function(image, i) {
        image = image.default
        if (!image.src) {
          return ''
        }
        var data = []
        // console.log(data)
        return (
          <div class="item">
            <img class="item__img" src={image.src || ''} alt={image.alt || ''} style={`--placeholder: url('https://imgs.adarshrkumar.dev/Photos/Places/${getFName(image.src || '') ||''}?w=25%25'); --img-width: ${image.width}px; --img-height: ${image.height}px`} loading="lazy" decoding="async" />
            {
              !!data.title ? <h3 class="item__title">{data.title}</h3> : ''
            }
            {
              !!data.location ? <span class="item__content">{data.location}</span> : ''
            }
          </div>
        )
      })
    }
  </SiteGridContent>
</Layout>